import{g as w,c as g,o as E,v as _,S as j,U as O,I as $,l as m,i as A,j as F,V as J,H as P,p as y}from"./CefbRbN0.js";import{c as V}from"./BUch4zJb.js";import{_ as Y}from"./DlAUqK2U.js";class d extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,d.prototype)}}const k=w({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(r,{expose:e,emit:t}){const l=P(),s=V(`form-${l}`),u=m(null);A(()=>{s.on(async n=>{var o;n.type!=="submit"&&((o=r.validateOn)!=null&&o.includes(n.type))&&await p(n.path,{silent:!0})})}),F(()=>{s.reset()});const a=m([]);y("form-errors",a),y("form-events",s);const h=m({});y("form-inputs",h);async function S(){let n=await r.validate(r.state);if(r.schema){const{errors:o,result:i}=await D(r.state,r.schema);o?n=n.concat(o):u.value=i}return n}async function p(n,o={silent:!1}){let i=n;if(n&&!Array.isArray(n)&&(i=[n]),i){const f=a.value.filter(c=>!i.includes(c.path)),v=(await S()).filter(c=>i.includes(c.path));a.value=f.concat(v)}else a.value=await S();if(a.value.length>0){if(o.silent)return!1;throw new d(`Form validation failed: ${JSON.stringify(a.value,null,2)}`)}return r.state}async function b(n){var i;const o=n;try{(i=r.validateOn)!=null&&i.includes("submit")&&await p(),o.data=r.schema?u.value:r.state,t("submit",o)}catch(f){if(!(f instanceof d))throw f;const v={...o,errors:a.value.map(c=>({...c,id:h.value[c.path]}))};t("error",v)}}return e({validate:p,errors:a,setErrors(n,o){o?a.value=a.value.filter(i=>i.path!==o).concat(n):a.value=n},async submit(){await b(new Event("submit"))},getErrors(n){return n?a.value.filter(o=>o.path===n):a.value},clear(n){n?a.value=a.value.filter(o=>o.path!==n):a.value=[]}}),{onSubmit:b,errors:J(a)}}});function B(r){return r.validate&&r.__isYupSchema__}function I(r){return r.inner!==void 0}function U(r){return"schema"in r&&typeof r.coercer=="function"&&typeof r.validator=="function"&&typeof r.refiner=="function"}function M(r){return r.validateAsync!==void 0&&r.id!==void 0}function Z(r){return r.isJoi===!0}function q(r){return"_parse"in r||"_run"in r||typeof r=="function"&&"schema"in r}function z(r){return r.parse!==void 0}async function C(r,e){const t=await("_parse"in e?e._parse(r):"_run"in e?e._run({typed:!1,value:r},{}):e(r));return!t.issues||t.issues.length===0?{errors:null,result:"output"in t?t.output:"value"in t?t.value:null}:{errors:t.issues.map(s=>{var u;return{path:((u=s.path)==null?void 0:u.map(a=>a.key).join("."))||"",message:s.message}}),result:null}}async function H(r,e){try{return{errors:null,result:await e.validateAsync(r,{abortEarly:!1})}}catch(t){if(Z(t))return{errors:t.details.map(s=>({path:s.path.join("."),message:s.message})),result:null};throw t}}async function N(r,e){const t=await e.safeParseAsync(r);return t.success===!1?{errors:t.error.issues.map(s=>({path:s.path.join("."),message:s.message})),result:null}:{result:t.data,errors:null}}async function R(r,e){const[t,l]=e.validate(r);return t?{errors:t.failures().map(u=>({message:u.message,path:u.path.join(".")})),result:null}:{errors:null,result:l}}async function x(r,e){try{return{errors:null,result:await e.validate(r,{abortEarly:!1})}}catch(t){if(I(t))return{errors:t.inner.map(s=>({path:s.path??"",message:s.message})),result:null};throw t}}function D(r,e){if(z(e))return N(r,e);if(M(e))return H(r,e);if(q(e))return C(r,e);if(B(e))return x(r,e);if(U(e))return R(r,e);throw new Error("Form validation failed: Unsupported form schema")}function G(r,e,t,l,s,u){return E(),g("form",{onSubmit:e[0]||(e[0]=$((...a)=>r.onSubmit&&r.onSubmit(...a),["prevent"]))},[_(r.$slots,"default",j(O({errors:r.errors})))],32)}const T=Y(k,[["render",G]]);export{T as default};
