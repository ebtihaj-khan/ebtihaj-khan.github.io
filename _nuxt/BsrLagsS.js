import{k as x,aE as J,aq as be,D as j,aH as ge,aI as oe,j as ue,g as K,i as le,l as P,m as Y,L as G,F as xe,ar as Oe,n as de,Y as _,O as B,p as ce,M as Se}from"./BwO4JJof.js";import{d as Ie,e as Re}from"./CDWv2em4.js";import{o as te,t as ie}from"./Bm92f-5u.js";import{i as Z,o as I,A as H,T as ne,u as W,E as ye,a as D,N as Q}from"./Dvt5nLqV.js";import{w as Ce,n as we}from"./B5zLmhx8.js";import{s as Ee}from"./CrM_gZ-l.js";import{u as Te,i as Me,c as A,f as se}from"./DHlO-M72.js";import{f as ze,u as Ae}from"./CD3PW12_.js";import{l as Fe,i as X,t as Pe}from"./B2O6VFkS.js";import{i as De,O as $e}from"./CKU8hLjh.js";function L(n,c,t){let o=t.initialDeps??[],e;return()=>{var s,i,l,p;let f;t.key&&((s=t.debug)!=null&&s.call(t))&&(f=Date.now());const u=n();if(!(u.length!==o.length||u.some((M,C)=>o[C]!==M)))return e;o=u;let O;if(t.key&&((i=t.debug)!=null&&i.call(t))&&(O=Date.now()),e=c(...u),t.key&&((l=t.debug)!=null&&l.call(t))){const M=Math.round((Date.now()-f)*100)/100,C=Math.round((Date.now()-O)*100)/100,F=C/16,$=(z,b)=>{for(z=String(z);z.length<b;)z=" "+z;return z};console.info(`%c⏱ ${$(C,5)} /${$(M,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*F,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(p=t==null?void 0:t.onChange)==null||p.call(t,e),e}}function ee(n,c){if(n===void 0)throw new Error("Unexpected undefined");return n}const Ve=(n,c)=>Math.abs(n-c)<1,ke=(n,c,t)=>{let o;return function(...e){n.clearTimeout(o),o=n.setTimeout(()=>c.apply(this,e),t)}},_e=n=>n,Be=n=>{const c=Math.max(n.startIndex-n.overscan,0),t=Math.min(n.endIndex+n.overscan,n.count-1),o=[];for(let e=c;e<=t;e++)o.push(e);return o},je=(n,c)=>{const t=n.scrollElement;if(!t)return;const o=n.targetWindow;if(!o)return;const e=i=>{const{width:l,height:p}=i;c({width:Math.round(l),height:Math.round(p)})};if(e(t.getBoundingClientRect()),!o.ResizeObserver)return()=>{};const s=new o.ResizeObserver(i=>{const l=()=>{const p=i[0];if(p!=null&&p.borderBoxSize){const f=p.borderBoxSize[0];if(f){e({width:f.inlineSize,height:f.blockSize});return}}e(t.getBoundingClientRect())};n.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return s.observe(t,{box:"border-box"}),()=>{s.unobserve(t)}},ae={passive:!0},re=typeof window>"u"?!0:"onscrollend"in window,Ne=(n,c)=>{const t=n.scrollElement;if(!t)return;const o=n.targetWindow;if(!o)return;let e=0;const s=n.options.useScrollendEvent&&re?()=>{}:ke(o,()=>{c(e,!1)},n.options.isScrollingResetDelay),i=u=>()=>{const{horizontal:h,isRtl:O}=n.options;e=h?t.scrollLeft*(O&&-1||1):t.scrollTop,s(),c(e,u)},l=i(!0),p=i(!1);p(),t.addEventListener("scroll",l,ae);const f=n.options.useScrollendEvent&&re;return f&&t.addEventListener("scrollend",p,ae),()=>{t.removeEventListener("scroll",l),f&&t.removeEventListener("scrollend",p)}},Le=(n,c,t)=>{if(c!=null&&c.borderBoxSize){const o=c.borderBoxSize[0];if(o)return Math.round(o[t.options.horizontal?"inlineSize":"blockSize"])}return Math.round(n.getBoundingClientRect()[t.options.horizontal?"width":"height"])},We=(n,{adjustments:c=0,behavior:t},o)=>{var e,s;const i=n+c;(s=(e=o.scrollElement)==null?void 0:e.scrollTo)==null||s.call(e,{[o.options.horizontal?"left":"top"]:i,behavior:t})};class Ke{constructor(c){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const o=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(e=>{e.forEach(s=>{const i=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()})}));return{disconnect:()=>{var e;(e=o())==null||e.disconnect(),t=null},observe:e=>{var s;return(s=o())==null?void 0:s.observe(e,{box:"border-box"})},unobserve:e=>{var s;return(s=o())==null?void 0:s.unobserve(e)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([o,e])=>{typeof e>"u"&&delete t[o]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:_e,rangeExtractor:Be,onChange:()=>{},measureElement:Le,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!0,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var o,e;(e=(o=this.options).onChange)==null||e.call(o,this,t)},this.maybeNotify=L(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const o=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==o){if(this.cleanup(),!o){this.maybeNotify();return}this.scrollElement=o,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=s,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,o)=>{const e=new Map,s=new Map;for(let i=o-1;i>=0;i--){const l=t[i];if(e.has(l.lane))continue;const p=s.get(l.lane);if(p==null||l.end>p.end?s.set(l.lane,l):l.end<p.end&&e.set(l.lane,!0),e.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((i,l)=>i.end===l.end?i.index-l.index:i.end-l.end)[0]:void 0},this.getMeasurementOptions=L(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,o,e,s,i)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:o,scrollMargin:e,getItemKey:s,enabled:i}),{key:!1}),this.getMeasurements=L(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:o,scrollMargin:e,getItemKey:s,enabled:i},l)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const p=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const f=this.measurementsCache.slice(0,p);for(let u=p;u<t;u++){const h=s(u),O=this.options.lanes===1?f[u-1]:this.getFurthestMeasurement(f,u),M=O?O.end+this.options.gap:o+e,C=l.get(h),F=typeof C=="number"?C:this.options.estimateSize(u),$=M+F,z=O?O.lane:u%this.options.lanes;f[u]={index:u,start:M,size:F,end:$,key:h,lane:z}}return this.measurementsCache=f,f},{key:!1,debug:()=>this.options.debug}),this.calculateRange=L(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset()],(t,o,e)=>this.range=t.length>0&&o>0?Ue({measurements:t,outerSize:o,scrollOffset:e}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=L(()=>{let t=null,o=null;const e=this.calculateRange();return e&&(t=e.startIndex,o=e.endIndex),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,o]},(t,o,e,s,i)=>s===null||i===null?[]:t({startIndex:s,endIndex:i,overscan:o,count:e}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const o=this.options.indexAttribute,e=t.getAttribute(o);return e?parseInt(e,10):(console.warn(`Missing attribute name '${o}={index}' on measured element.`),-1)},this._measureElement=(t,o)=>{const e=this.indexFromElement(t),s=this.measurementsCache[e];if(!s)return;const i=s.key,l=this.elementsCache.get(i);l!==t&&(l&&this.observer.unobserve(l),this.observer.observe(t),this.elementsCache.set(i,t)),t.isConnected&&this.resizeItem(e,this.options.measureElement(t,o,this))},this.resizeItem=(t,o)=>{const e=this.measurementsCache[t];if(!e)return;const s=this.itemSizeCache.get(e.key)??e.size,i=o-s;i!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(e,i,this):e.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,o)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((o,e)=>{o.isConnected||(this.observer.unobserve(o),this.elementsCache.delete(e))});return}this._measureElement(t,void 0)},this.getVirtualItems=L(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,o)=>{const e=[];for(let s=0,i=t.length;s<i;s++){const l=t[s],p=o[l];e.push(p)}return e},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const o=this.getMeasurements();if(o.length!==0)return ee(o[ve(0,o.length-1,e=>ee(o[e]).start,t)])},this.getOffsetForAlignment=(t,o)=>{const e=this.getSize(),s=this.getScrollOffset();o==="auto"&&t>=s+e&&(o="end"),o==="end"&&(t-=e);const i=this.options.horizontal?"scrollWidth":"scrollHeight",p=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[i]:this.scrollElement[i]:0)-e;return Math.max(Math.min(p,t),0)},this.getOffsetForIndex=(t,o="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const e=this.measurementsCache[t];if(!e)return;const s=this.getSize(),i=this.getScrollOffset();if(o==="auto")if(e.end>=i+s-this.options.scrollPaddingEnd)o="end";else if(e.start<=i+this.options.scrollPaddingStart)o="start";else return[i,o];const l=e.start-this.options.scrollPaddingStart+(e.size-s)/2;switch(o){case"center":return[this.getOffsetForAlignment(l,o),o];case"end":return[this.getOffsetForAlignment(e.end+this.options.scrollPaddingEnd,o),o];default:return[this.getOffsetForAlignment(e.start-this.options.scrollPaddingStart,o),o]}},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(t,{align:o="start",behavior:e}={})=>{this.cancelScrollToIndex(),e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,o),{adjustments:void 0,behavior:e})},this.scrollToIndex=(t,{align:o="auto",behavior:e}={})=>{t=Math.max(0,Math.min(t,this.options.count-1)),this.cancelScrollToIndex(),e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const s=this.getOffsetForIndex(t,o);if(!s)return;const[i,l]=s;this._scrollToOffset(i,{adjustments:void 0,behavior:e}),e!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(t))){const[f]=ee(this.getOffsetForIndex(t,l));Ve(f,this.getScrollOffset())||this.scrollToIndex(t,{align:l,behavior:e})}else this.scrollToIndex(t,{align:l,behavior:e})}))},this.scrollBy=(t,{behavior:o}={})=>{this.cancelScrollToIndex(),o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:o})},this.getTotalSize=()=>{var t;const o=this.getMeasurements();let e;return o.length===0?e=this.options.paddingStart:e=this.options.lanes===1?((t=o[o.length-1])==null?void 0:t.end)??0:Math.max(...o.slice(-this.options.lanes).map(s=>s.end)),Math.max(e-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:o,behavior:e})=>{this.options.scrollToFn(t,{behavior:e,adjustments:o},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(c)}}const ve=(n,c,t,o)=>{for(;n<=c;){const e=(n+c)/2|0,s=t(e);if(s<o)n=e+1;else if(s>o)c=e-1;else return e}return n>0?n-1:0};function Ue({measurements:n,outerSize:c,scrollOffset:t}){const o=n.length-1,s=ve(0,o,l=>n[l].start,t);let i=s;for(;i<o&&n[i].end<t+c;)i++;return{startIndex:s,endIndex:i}}function qe(n){const c=new Ke(J(n)),t=be(c),o=c._didMount();return j(()=>J(n).getScrollElement(),e=>{e&&c._willUpdate()},{immediate:!0}),j(()=>J(n),e=>{c.setOptions({...e,onChange:(s,i)=>{var l;oe(t),(l=e.onChange)==null||l.call(e,s,i)}}),c._willUpdate(),oe(t)},{immediate:!0}),ge(o),t}function He(n){return qe(x(()=>({observeElementRect:je,observeElementOffset:Ne,scrollToFn:We,...J(n)})))}function Je(){let n=te();return ue(()=>n.dispose()),n}function Ye(){let n=Je();return c=>{n.dispose(),n.nextFrame(c)}}var fe=(n=>(n[n.Left=0]="Left",n[n.Right=2]="Right",n))(fe||{}),Ge={};function Qe(n,c){return n===c}var Xe=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(Xe||{}),Ze=(n=>(n[n.Single=0]="Single",n[n.Multi=1]="Multi",n))(Ze||{}),et=(n=>(n[n.Pointer=0]="Pointer",n[n.Focus=1]="Focus",n[n.Other=2]="Other",n))(et||{});let pe=Symbol("ComboboxContext");function U(n){let c=de(pe,null);if(c===null){let t=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,U),t}return c}let he=Symbol("VirtualContext"),tt=K({name:"VirtualProvider",setup(n,{slots:c}){let t=U("VirtualProvider"),o=x(()=>{let l=I(t.optionsRef);if(!l)return{start:0,end:0};let p=window.getComputedStyle(l);return{start:parseFloat(p.paddingBlockStart||p.paddingTop),end:parseFloat(p.paddingBlockEnd||p.paddingBottom)}}),e=He(x(()=>({scrollPaddingStart:o.value.start,scrollPaddingEnd:o.value.end,count:t.virtual.value.options.length,estimateSize(){return 40},getScrollElement(){return I(t.optionsRef)},overscan:12}))),s=x(()=>{var l;return(l=t.virtual.value)==null?void 0:l.options}),i=P(0);return j([s],()=>{i.value+=1}),ce(he,t.virtual.value?e:null),()=>[G("div",{style:{position:"relative",width:"100%",height:`${e.value.getTotalSize()}px`},ref:l=>{if(l){if(typeof process<"u"&&Ge.JEST_WORKER_ID!==void 0||t.activationTrigger.value===0)return;t.activeOptionIndex.value!==null&&t.virtual.value.options.length>t.activeOptionIndex.value&&e.value.scrollToIndex(t.activeOptionIndex.value)}}},e.value.getVirtualItems().map(l=>Se(c.default({option:t.virtual.value.options[l.index],open:t.comboboxState.value===0})[0],{key:`${i.value}-${l.index}`,"data-index":l.index,"aria-setsize":t.virtual.value.options.length,"aria-posinset":l.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${l.start}px)`,overflowAnchor:"none"}})))]}}),vt=K({name:"Combobox",emits:{"update:modelValue":n=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],nullable:!0,default:null},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},nullable:{type:Boolean,default:!1},multiple:{type:[Boolean],default:!1},immediate:{type:[Boolean],default:!1},virtual:{type:Object,default:null}},inheritAttrs:!1,setup(n,{slots:c,attrs:t,emit:o}){let e=P(1),s=P(null),i=P(null),l=P(null),p=P(null),f=P({static:!1,hold:!1}),u=P([]),h=P(null),O=P(2),M=P(!1);function C(a=d=>d){let d=h.value!==null?u.value[h.value]:null,m=a(u.value.slice()),g=m.length>0&&m[0].dataRef.order.value!==null?m.sort((T,k)=>T.dataRef.order.value-k.dataRef.order.value):$e(m,T=>I(T.dataRef.domRef)),E=d?g.indexOf(d):null;return E===-1&&(E=null),{options:g,activeOptionIndex:E}}let F=x(()=>n.multiple?1:0),$=x(()=>n.nullable),[z,b]=Ie(x(()=>n.modelValue),a=>o("update:modelValue",a),x(()=>n.defaultValue)),w=x(()=>z.value===void 0?W(F.value,{1:[],0:void 0}):z.value),V=null,v=null;function R(a){return W(F.value,{0(){return b==null?void 0:b(a)},1:()=>{let d=_(r.value.value).slice(),m=_(a),g=d.findIndex(E=>r.compare(m,_(E)));return g===-1?d.push(m):d.splice(g,1),b==null?void 0:b(d)}})}let y=x(()=>{});j([y],([a],[d])=>{if(r.virtual.value&&a&&d&&h.value!==null){let m=a.indexOf(d[h.value]);m!==-1?h.value=m:h.value=null}});let r={comboboxState:e,value:w,mode:F,compare(a,d){if(typeof n.by=="string"){let m=n.by;return(a==null?void 0:a[m])===(d==null?void 0:d[m])}return n.by===null?Qe(a,d):n.by(a,d)},calculateIndex(a){return r.virtual.value?n.by===null?r.virtual.value.options.indexOf(a):r.virtual.value.options.findIndex(d=>r.compare(d,a)):u.value.findIndex(d=>r.compare(d.dataRef.value,a))},defaultValue:x(()=>n.defaultValue),nullable:$,immediate:x(()=>!1),virtual:x(()=>null),inputRef:i,labelRef:s,buttonRef:l,optionsRef:p,disabled:x(()=>n.disabled),options:u,change(a){b(a)},activeOptionIndex:x(()=>{if(M.value&&h.value===null&&(r.virtual.value?r.virtual.value.options.length>0:u.value.length>0)){if(r.virtual.value){let d=r.virtual.value.options.findIndex(m=>{var g;return!((g=r.virtual.value)!=null&&g.disabled(m))});if(d!==-1)return d}let a=u.value.findIndex(d=>!d.dataRef.disabled);if(a!==-1)return a}return h.value}),activationTrigger:O,optionsPropsRef:f,closeCombobox(){M.value=!1,!n.disabled&&e.value!==1&&(e.value=1,h.value=null)},openCombobox(){if(M.value=!0,!n.disabled&&e.value!==0){if(r.value.value){let a=r.calculateIndex(r.value.value);a!==-1&&(h.value=a)}e.value=0}},setActivationTrigger(a){O.value=a},goToOption(a,d,m){M.value=!1,V!==null&&cancelAnimationFrame(V),V=requestAnimationFrame(()=>{if(n.disabled||p.value&&!f.value.static&&e.value===1)return;if(r.virtual.value){h.value=a===A.Specific?d:se({focus:a},{resolveItems:()=>r.virtual.value.options,resolveActiveIndex:()=>{var T,k;return(k=(T=r.activeOptionIndex.value)!=null?T:r.virtual.value.options.findIndex(N=>{var q;return!((q=r.virtual.value)!=null&&q.disabled(N))}))!=null?k:null},resolveDisabled:T=>r.virtual.value.disabled(T),resolveId(){throw new Error("Function not implemented.")}}),O.value=m??2;return}let g=C();if(g.activeOptionIndex===null){let T=g.options.findIndex(k=>!k.dataRef.disabled);T!==-1&&(g.activeOptionIndex=T)}let E=a===A.Specific?d:se({focus:a},{resolveItems:()=>g.options,resolveActiveIndex:()=>g.activeOptionIndex,resolveId:T=>T.id,resolveDisabled:T=>T.dataRef.disabled});h.value=E,O.value=m??2,u.value=g.options})},selectOption(a){let d=u.value.find(g=>g.id===a);if(!d)return;let{dataRef:m}=d;R(m.value)},selectActiveOption(){if(r.activeOptionIndex.value!==null){if(r.virtual.value)R(r.virtual.value.options[r.activeOptionIndex.value]);else{let{dataRef:a}=u.value[r.activeOptionIndex.value];R(a.value)}r.goToOption(A.Specific,r.activeOptionIndex.value)}},registerOption(a,d){let m=Oe({id:a,dataRef:d});if(r.virtual.value){u.value.push(m);return}v&&cancelAnimationFrame(v);let g=C(E=>(E.push(m),E));h.value===null&&r.isSelected(d.value.value)&&(g.activeOptionIndex=g.options.indexOf(m)),u.value=g.options,h.value=g.activeOptionIndex,O.value=2,g.options.some(E=>!I(E.dataRef.domRef))&&(v=requestAnimationFrame(()=>{let E=C();u.value=E.options,h.value=E.activeOptionIndex}))},unregisterOption(a,d){if(V!==null&&cancelAnimationFrame(V),d&&(M.value=!0),r.virtual.value){u.value=u.value.filter(g=>g.id!==a);return}let m=C(g=>{let E=g.findIndex(T=>T.id===a);return E!==-1&&g.splice(E,1),g});u.value=m.options,h.value=m.activeOptionIndex,O.value=2},isSelected(a){return W(F.value,{0:()=>r.compare(_(r.value.value),_(a)),1:()=>_(r.value.value).some(d=>r.compare(_(d),_(a)))})},isActive(a){return h.value===r.calculateIndex(a)}};Ce([i,l,p],()=>r.closeCombobox(),x(()=>e.value===0)),ce(pe,r),Pe(x(()=>W(e.value,{0:X.Open,1:X.Closed})));let S=x(()=>{var a;return(a=I(i))==null?void 0:a.closest("form")});return le(()=>{j([S],()=>{if(!S.value||n.defaultValue===void 0)return;function a(){r.change(n.defaultValue)}return S.value.addEventListener("reset",a),()=>{var d;(d=S.value)==null||d.removeEventListener("reset",a)}},{immediate:!0})}),()=>{var a,d,m;let{name:g,disabled:E,form:T,...k}=n,N={open:e.value===0,disabled:E,activeIndex:r.activeOptionIndex.value,activeOption:r.activeOptionIndex.value===null?null:r.virtual.value?r.virtual.value.options[(a=r.activeOptionIndex.value)!=null?a:0]:(m=(d=r.options.value[r.activeOptionIndex.value])==null?void 0:d.dataRef.value)!=null?m:null,value:w.value};return G(xe,[...g!=null&&w.value!=null?Re({[g]:w.value}).map(([q,me])=>G(ze,ye({features:Ae.Hidden,key:q,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:T,disabled:E,name:q,value:me}))):[],H({theirProps:{...t,...ne(k,["by","defaultValue","immediate","modelValue","multiple","nullable","onUpdate:modelValue","virtual"])},ourProps:{},slot:N,slots:c,attrs:t,name:"Combobox"})])}}}),ft=K({name:"ComboboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(n,{attrs:c,slots:t,expose:o}){var e;let s=(e=n.id)!=null?e:`headlessui-combobox-button-${Z()}`,i=U("ComboboxButton");o({el:i.buttonRef,$el:i.buttonRef});function l(u){i.disabled.value||(i.comboboxState.value===0?i.closeCombobox():(u.preventDefault(),i.openCombobox()),B(()=>{var h;return(h=I(i.inputRef))==null?void 0:h.focus({preventScroll:!0})}))}function p(u){switch(u.key){case D.ArrowDown:u.preventDefault(),u.stopPropagation(),i.comboboxState.value===1&&i.openCombobox(),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return;case D.ArrowUp:u.preventDefault(),u.stopPropagation(),i.comboboxState.value===1&&(i.openCombobox(),B(()=>{i.value.value||i.goToOption(A.Last)})),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return;case D.Escape:if(i.comboboxState.value!==0)return;u.preventDefault(),i.optionsRef.value&&!i.optionsPropsRef.value.static&&u.stopPropagation(),i.closeCombobox(),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return}}let f=Ee(x(()=>({as:n.as,type:c.type})),i.buttonRef);return()=>{var u,h;let O={open:i.comboboxState.value===0,disabled:i.disabled.value,value:i.value.value},{...M}=n,C={ref:i.buttonRef,id:s,type:f.value,tabindex:"-1","aria-haspopup":"listbox","aria-controls":(u=I(i.optionsRef))==null?void 0:u.id,"aria-expanded":i.comboboxState.value===0,"aria-labelledby":i.labelRef.value?[(h=I(i.labelRef))==null?void 0:h.id,s].join(" "):void 0,disabled:i.disabled.value===!0?!0:void 0,onKeydown:p,onClick:l};return H({ourProps:C,theirProps:M,slot:O,attrs:c,slots:t,name:"ComboboxButton"})}}}),pt=K({name:"ComboboxInput",props:{as:{type:[Object,String],default:"input"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},displayValue:{type:Function},defaultValue:{type:String,default:void 0},id:{type:String,default:null}},emits:{change:n=>!0},setup(n,{emit:c,attrs:t,slots:o,expose:e}){var s;let i=(s=n.id)!=null?s:`headlessui-combobox-input-${Z()}`,l=U("ComboboxInput"),p=x(()=>De(I(l.inputRef))),f={value:!1};e({el:l.inputRef,$el:l.inputRef});function u(){l.change(null);let v=I(l.optionsRef);v&&(v.scrollTop=0),l.goToOption(A.Nothing)}let h=x(()=>{var v;let R=l.value.value;return I(l.inputRef)?typeof n.displayValue<"u"&&R!==void 0?(v=n.displayValue(R))!=null?v:"":typeof R=="string"?R:"":""});le(()=>{j([h,l.comboboxState,p],([v,R],[y,r])=>{if(f.value)return;let S=I(l.inputRef);S&&((r===0&&R===1||v!==y)&&(S.value=v),requestAnimationFrame(()=>{var a;if(f.value||!S||((a=p.value)==null?void 0:a.activeElement)!==S)return;let{selectionStart:d,selectionEnd:m}=S;Math.abs((m??0)-(d??0))===0&&d===0&&S.setSelectionRange(S.value.length,S.value.length)}))},{immediate:!0}),j([l.comboboxState],([v],[R])=>{if(v===0&&R===1){if(f.value)return;let y=I(l.inputRef);if(!y)return;let r=y.value,{selectionStart:S,selectionEnd:a,selectionDirection:d}=y;y.value="",y.value=r,d!==null?y.setSelectionRange(S,a,d):y.setSelectionRange(S,a)}})});let O=P(!1);function M(){O.value=!0}function C(){te().nextFrame(()=>{O.value=!1})}let F=Ye();function $(v){switch(f.value=!0,F(()=>{f.value=!1}),v.key){case D.Enter:if(f.value=!1,l.comboboxState.value!==0||O.value)return;if(v.preventDefault(),v.stopPropagation(),l.activeOptionIndex.value===null){l.closeCombobox();return}l.selectActiveOption(),l.mode.value===0&&l.closeCombobox();break;case D.ArrowDown:return f.value=!1,v.preventDefault(),v.stopPropagation(),W(l.comboboxState.value,{0:()=>l.goToOption(A.Next),1:()=>l.openCombobox()});case D.ArrowUp:return f.value=!1,v.preventDefault(),v.stopPropagation(),W(l.comboboxState.value,{0:()=>l.goToOption(A.Previous),1:()=>{l.openCombobox(),B(()=>{l.value.value||l.goToOption(A.Last)})}});case D.Home:if(v.shiftKey)break;return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(A.First);case D.PageUp:return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(A.First);case D.End:if(v.shiftKey)break;return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(A.Last);case D.PageDown:return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(A.Last);case D.Escape:if(f.value=!1,l.comboboxState.value!==0)return;v.preventDefault(),l.optionsRef.value&&!l.optionsPropsRef.value.static&&v.stopPropagation(),l.nullable.value&&l.mode.value===0&&l.value.value===null&&u(),l.closeCombobox();break;case D.Tab:if(f.value=!1,l.comboboxState.value!==0)return;l.mode.value===0&&l.activationTrigger.value!==1&&l.selectActiveOption(),l.closeCombobox();break}}function z(v){c("change",v),l.nullable.value&&l.mode.value===0&&v.target.value===""&&u(),l.openCombobox()}function b(v){var R,y,r;let S=(R=v.relatedTarget)!=null?R:ie.find(a=>a!==v.currentTarget);if(f.value=!1,!((y=I(l.optionsRef))!=null&&y.contains(S))&&!((r=I(l.buttonRef))!=null&&r.contains(S))&&l.comboboxState.value===0)return v.preventDefault(),l.mode.value===0&&(l.nullable.value&&l.value.value===null?u():l.activationTrigger.value!==1&&l.selectActiveOption()),l.closeCombobox()}function w(v){var R,y,r;let S=(R=v.relatedTarget)!=null?R:ie.find(a=>a!==v.currentTarget);(y=I(l.buttonRef))!=null&&y.contains(S)||(r=I(l.optionsRef))!=null&&r.contains(S)||l.disabled.value||l.immediate.value&&l.comboboxState.value!==0&&(l.openCombobox(),te().nextFrame(()=>{l.setActivationTrigger(1)}))}let V=x(()=>{var v,R,y,r;return(r=(y=(R=n.defaultValue)!=null?R:l.defaultValue.value!==void 0?(v=n.displayValue)==null?void 0:v.call(n,l.defaultValue.value):null)!=null?y:l.defaultValue.value)!=null?r:""});return()=>{var v,R,y,r,S,a,d;let m={open:l.comboboxState.value===0},{displayValue:g,onChange:E,...T}=n,k={"aria-controls":(v=l.optionsRef.value)==null?void 0:v.id,"aria-expanded":l.comboboxState.value===0,"aria-activedescendant":l.activeOptionIndex.value===null?void 0:l.virtual.value?(R=l.options.value.find(N=>!l.virtual.value.disabled(N.dataRef.value)&&l.compare(N.dataRef.value,l.virtual.value.options[l.activeOptionIndex.value])))==null?void 0:R.id:(y=l.options.value[l.activeOptionIndex.value])==null?void 0:y.id,"aria-labelledby":(a=(r=I(l.labelRef))==null?void 0:r.id)!=null?a:(S=I(l.buttonRef))==null?void 0:S.id,"aria-autocomplete":"list",id:i,onCompositionstart:M,onCompositionend:C,onKeydown:$,onInput:z,onFocus:w,onBlur:b,role:"combobox",type:(d=t.type)!=null?d:"text",tabIndex:0,ref:l.inputRef,defaultValue:V.value,disabled:l.disabled.value===!0?!0:void 0};return H({ourProps:k,theirProps:T,slot:m,attrs:t,slots:o,features:Q.RenderStrategy|Q.Static,name:"ComboboxInput"})}}}),ht=K({name:"ComboboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},hold:{type:[Boolean],default:!1}},setup(n,{attrs:c,slots:t,expose:o}){let e=U("ComboboxOptions"),s=`headlessui-combobox-options-${Z()}`;o({el:e.optionsRef,$el:e.optionsRef}),Y(()=>{e.optionsPropsRef.value.static=n.static}),Y(()=>{e.optionsPropsRef.value.hold=n.hold});let i=Fe(),l=x(()=>i!==null?(i.value&X.Open)===X.Open:e.comboboxState.value===0);Me({container:x(()=>I(e.optionsRef)),enabled:x(()=>e.comboboxState.value===0),accept(f){return f.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:f.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(f){f.setAttribute("role","none")}});function p(f){f.preventDefault()}return()=>{var f,u,h;let O={open:e.comboboxState.value===0},M={"aria-labelledby":(h=(f=I(e.labelRef))==null?void 0:f.id)!=null?h:(u=I(e.buttonRef))==null?void 0:u.id,id:s,ref:e.optionsRef,role:"listbox","aria-multiselectable":e.mode.value===1?!0:void 0,onMousedown:p},C=ne(n,["hold"]);return H({ourProps:M,theirProps:C,slot:O,attrs:c,slots:e.virtual.value&&e.comboboxState.value===0?{...t,default:()=>[G(tt,{},t.default)]}:t,features:Q.RenderStrategy|Q.Static,visible:l.value,name:"ComboboxOptions"})}}}),mt=K({name:"ComboboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},order:{type:[Number],default:null}},setup(n,{slots:c,attrs:t,expose:o}){let e=U("ComboboxOption"),s=`headlessui-combobox-option-${Z()}`,i=P(null),l=x(()=>n.disabled);o({el:i,$el:i});let p=x(()=>{var b;return e.virtual.value?e.activeOptionIndex.value===e.calculateIndex(n.value):e.activeOptionIndex.value===null?!1:((b=e.options.value[e.activeOptionIndex.value])==null?void 0:b.id)===s}),f=x(()=>e.isSelected(n.value)),u=de(he,null),h=x(()=>({disabled:n.disabled,value:n.value,domRef:i,order:x(()=>n.order)}));le(()=>e.registerOption(s,h)),ue(()=>e.unregisterOption(s,p.value)),Y(()=>{let b=I(i);b&&(u==null||u.value.measureElement(b))}),Y(()=>{e.comboboxState.value===0&&p.value&&(e.virtual.value||e.activationTrigger.value!==0&&B(()=>{var b,w;return(w=(b=I(i))==null?void 0:b.scrollIntoView)==null?void 0:w.call(b,{block:"nearest"})}))});function O(b){b.preventDefault(),b.button===fe.Left&&(l.value||(e.selectOption(s),we()||requestAnimationFrame(()=>{var w;return(w=I(e.inputRef))==null?void 0:w.focus({preventScroll:!0})}),e.mode.value===0&&e.closeCombobox()))}function M(){var b;if(n.disabled||(b=e.virtual.value)!=null&&b.disabled(n.value))return e.goToOption(A.Nothing);let w=e.calculateIndex(n.value);e.goToOption(A.Specific,w)}let C=Te();function F(b){C.update(b)}function $(b){var w;if(!C.wasMoved(b)||n.disabled||(w=e.virtual.value)!=null&&w.disabled(n.value)||p.value)return;let V=e.calculateIndex(n.value);e.goToOption(A.Specific,V,0)}function z(b){var w;C.wasMoved(b)&&(n.disabled||(w=e.virtual.value)!=null&&w.disabled(n.value)||p.value&&(e.optionsPropsRef.value.hold||e.goToOption(A.Nothing)))}return()=>{let{disabled:b}=n,w={active:p.value,selected:f.value,disabled:b},V={id:s,ref:i,role:"option",tabIndex:b===!0?void 0:-1,"aria-disabled":b===!0?!0:void 0,"aria-selected":f.value,disabled:void 0,onMousedown:O,onFocus:M,onPointerenter:F,onMouseenter:F,onPointermove:$,onMousemove:$,onPointerleave:z,onMouseleave:z},v=ne(n,["order","value"]);return H({ourProps:V,theirProps:v,slot:w,attrs:t,slots:c,name:"ComboboxOption"})}}});export{pt as i,vt as l,ft as n,mt as r,ht as u};
